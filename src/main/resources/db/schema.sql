CREATE TABLE IF NOT EXISTS account_role (
    id BIGINT PRIMARY KEY NOT NULL GENERATED BY DEFAULT AS IDENTITY,
    name VARCHAR(100) UNIQUE NOT NULL
);

CREATE TABLE IF NOT EXISTS answer_status (
    id BIGINT PRIMARY KEY NOT NULL GENERATED BY DEFAULT AS IDENTITY,
    name VARCHAR(100) UNIQUE NOT NULL
);

CREATE TABLE IF NOT EXISTS account (
    id BIGINT PRIMARY KEY NOT NULL GENERATED BY DEFAULT AS IDENTITY,
    name VARCHAR(100) NOT NULL,
    password VARCHAR(100) NOT NULL,
    account_role_id BIGINT UNIQUE NOT NULL,
    FOREIGN KEY (account_role_id) REFERENCES account_role(id)
    );

CREATE TABLE IF NOT EXISTS task (
    id BIGINT PRIMARY KEY NOT NULL GENERATED BY DEFAULT AS IDENTITY,
    name VARCHAR(100) NOT NULL,
    description VARCHAR(100) NOT NULL,
    account_id BIGINT UNIQUE NOT NULL,
    FOREIGN KEY (account_id) REFERENCES account(id)
    );

CREATE TABLE IF NOT EXISTS answer (
    id BIGINT PRIMARY KEY NOT NULL GENERATED BY DEFAULT AS IDENTITY,
    account_id BIGINT UNIQUE NOT NULL,
    task_id BIGINT UNIQUE NOT NULL,
    answer_status_id BIGINT UNIQUE NOT NULL,
    FOREIGN KEY (account_id) REFERENCES account(id),
    FOREIGN KEY (task_id) REFERENCES task(id),
    FOREIGN KEY (answer_status_id) REFERENCES answer_status(id)
    );

CREATE TABLE IF NOT EXISTS file (
    id BIGINT PRIMARY KEY NOT NULL GENERATED BY DEFAULT AS IDENTITY,
    file_path VARCHAR(300) NOT NULL,
    answer_id BIGINT UNIQUE NOT NULL,
    FOREIGN KEY (answer_id) REFERENCES answer(id)
    );

CREATE TABLE IF NOT EXISTS comment (
    id BIGINT PRIMARY KEY NOT NULL GENERATED BY DEFAULT AS IDENTITY,
    text TEXT NOT NULL,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    account_id BIGINT UNIQUE NOT NULL,
    answer_id BIGINT UNIQUE NOT NULL,
    file_id BIGINT UNIQUE,
    line_number INTEGER,
    FOREIGN KEY (account_id) REFERENCES account(id),
    FOREIGN KEY (answer_id) REFERENCES answer(id),
    FOREIGN KEY (file_id) REFERENCES file(id)
    );

INSERT INTO account_role (name)
VALUES ('TEACHER'),('STUDENT')
ON CONFLICT (name) DO NOTHING;;

INSERT INTO answer_status (name)
values ('NOT_VIEWED'), ('UPDATED'), ('ACCEPTED'), ('REJECTED')
ON CONFLICT (name) DO NOTHING;;